parameters:
  - name: feedName
    type: string
    default: 'AndroidBroker-Broker'
  - name: serviceConnection
    type: string
    default: 'AndroidBroker-CI'
  - name: oldMsalTestAppVersion
    displayName: Old MSAL Test App Version
    type: string
    default: '4.5.0'
  - name: oldOneAuthTestAppVersion
    displayName: Old OneAuth Test App Version
    type: string
    default: '0.20230614.1'

jobs:
  - job: 'download_old_test_apps'
    displayName: Download Old Test Apps
    pool:
      vmImage: ubuntu-latest
    steps:
      - checkout: none
      - script: mkdir oldTestApps
        displayName: 'Make oldTestApps dir'
        workingDirectory: '$(Build.ArtifactStagingDirectory)'
      - task: UniversalPackages@0
        displayName: 'Download Old Msal Test App Apk'
        inputs:
          command: 'download'
          downloadDirectory: '$(Build.ArtifactStagingDirectory)/oldtestapps'
          feedsToUse: 'external'
          externalFeedCredentials: '${{ parameters.serviceConnection }}'
          feedDownloadExternal: '${{ parameters.feedName }}'
          packageDownloadExternal: 'com.microsoft.identity.client.testapp'
          versionDownloadExternal: '${{ parameters.oldMsalTestAppVersion }}'
      - task: UniversalPackages@0
        displayName: 'Download Old OneAuth Test App Apk'
        inputs:
          command: 'download'
          downloadDirectory: '$(Build.ArtifactStagingDirectory)/oldtestapps'
          feedsToUse: 'external'
          externalFeedCredentials: '${{ parameters.serviceConnection }}'
          feedDownloadExternal: '${{ parameters.feedName }}'
          packageDownloadExternal: 'com.microsoft.oneauth.testapp'
          versionDownloadExternal: '${{ parameters.oldOneAuthTestAppVersion }}'
      - publish: $(Build.ArtifactStagingDirectory)/oldtestapps
        displayName: 'Publish Old Test App APKs'
        artifact: oldtestapps